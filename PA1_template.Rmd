# Data Loading
### Load activity date
```{r, echo=TRUE}
activity.data <- read.csv("activity.csv")
```

# Data Cleaning
### Convert the date field to Date class and remove records where steps is NA or 0
```{r, echo=TRUE}
activity.data$date <- as.Date(activity.data$date)
activity.data.wo.na <- activity.data[! is.na(activity.data$steps),]
```

# Histogram of Number of Steps by day
### 1. Generate a data table for easier calculation
```{r, echo=TRUE}
library(data.table)
activity.data.wo.na.tb <- data.table(activity.data.wo.na)
```
### 2. Calculate Total Number of Steps by day
```{r, echo=TRUE}
nb.steps.per.day <- activity.data.wo.na.tb[,sum(steps),by=date]
```
### 3. Plot the histogram
```{r,fig.width=7, fig.height=6, echo=TRUE}
hist(nb.steps.per.day$V1,col=4,main="",xlab="Number of Steps Taken per Day",breaks=25)
```

# Calculate and Report mean and median
### 1. Average Number of Steps per Day
```{r, echo=TRUE}
mean(nb.steps.per.day$V1)
```
### 2. Median Number of Steps per Day
```{r, echo=TRUE}
median(nb.steps.per.day$V1)
```

# Plot a time series of the 5-minute interval and the average number of steps taken, averaged across all days
### 1. Calculate average number of steps for each interval
```{r, echo=TRUE}
avg.nb.steps.per.interval <- activity.data.wo.na.tb[,mean(steps),by=interval]
```
### 2. Plot the average number of steps per interval
```{r, echo=TRUE}
plot(avg.nb.steps.per.interval,type="l",ylab="Average number of steps")
```
### 3. Interval with the max average number of steps
```{r, echo=TRUE}
avg.nb.steps.per.interval[which.max(avg.nb.steps.per.interval$V1),interval]
```

# Missing values
### Number of records with missing number of steps
```{r, echo=TRUE}
nrow(activity.data[is.na(activity.data$steps),])
```
### Generate data table including NA
```{r, echo=TRUE}
activity.data.tb <- data.table(activity.data)
```
### Add new column containing mean of the interval across all days
Note: Chose interval means rather than day because some day have no data at all, hence returning a mean of NA
```{r, echo=TRUE}
activity.data.tb <- activity.data.tb[,avg.steps.interval:=mean(steps,na.rm=TRUE),by=interval]
```
### Create new data frame replacing NA steps with average steps for respective interval
```{r, echo=TRUE}
activity.data.fix.na <- as.data.frame(activity.data.tb)
activity.data.fix.na[is.na(activity.data.fix.na$steps),]$steps <- activity.data.fix.na[is.na(activity.data.fix.na$steps),]$avg.steps.interval
```
### Histogram of Number of Steps by day following same process as earlier on
```{r, fig.width=15, fig.height=6, echo=TRUE}
activity.data.fix.na.tb <- data.table(activity.data.fix.na)
nb.steps.per.day.fix.na <- activity.data.fix.na.tb[,sum(steps),by=date]
par(mfrow=c(1,2))
hist(nb.steps.per.day.fix.na$V1,col=3,xlab="Number of Steps Taken per Day",breaks=25,main="With NA replaced",ylim=c(0,20),xlim=c(0,25000))
hist(nb.steps.per.day$V1,col=4,xlab="Number of Steps Taken per Day",breaks=25,main="Excluding NA",ylim=c(0,20),xlim=c(0,25000))
```
### Average Number of Steps per Day when NA are replaced with average steps for each interval
```{r, echo=TRUE}
mean(nb.steps.per.day.fix.na$V1)
```
### Median Number of Steps per Day when NA are replaced with average steps for each interval
```{r, echo=TRUE}
median(nb.steps.per.day.fix.na$V1)
```
### Findings: 
* In this dataset, fixing NA doesn't affect the mean or the median total number of steps taken per day as NA are only found across an entire day rather
* The frequency at the mean is higher, which makes sense since we have replaced NA with the average number of steps. Other buckets are unchanged.

# Weekdays vs Weekends
### 1. Add the day category (daycat) factor to the data frame
```{r, echo=TRUE}
activity.data.fix.na$daycat <- weekdays(activity.data.fix.na$date)
activity.data.fix.na[activity.data.fix.na$daycat %in% c("Saturday","Sunday"),]$daycat <- "weekend"
activity.data.fix.na[! activity.data.fix.na$daycat %in% c("Saturday","Sunday"),]$daycat <- "weekday"
activity.data.fix.na$daycat <- as.factor(activity.data.fix.na$daycat)
```
### 2. Plot the steps by day category using Lattice plotting system
```{r, echo=TRUE, fig.width=10, fig.height=6}
library(lattice)
activity.data.fix.na.tb <- data.table(activity.data.fix.na)
```